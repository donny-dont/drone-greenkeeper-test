pipeline:
  greenkeeper_update_lockfile:
    image: node:9
    commands:
      - printenv
      - npm i -g npm@latest
      - npm install -g git+https://github.com/donny-dont/greenkeeper-lockfile.git#9ec3e23111db43a8cb23b5cbfa683be926abcfe0
      - greenkeeper-lockfile-update
#    when:
#      branch: greenkeeper*
        
  build:
    image: node:9
    commands:
      - printenv
      - echo 'HELLO WORLD I R DRONE'
      - npm i -g npm@latest
      - npm ci
    environment:
      - TEST=foo-${NODE_VERSION}.tar
      
  greenkeeper_lockfile_upload:
    image: node:9
    secrets: [gh_token]
    commands:
      - git rev-parse --abbrev-ref HEAD
      - npm install -g git+https://github.com/donny-dont/greenkeeper-lockfile.git#9ec3e23111db43a8cb23b5cbfa683be926abcfe0
      - greenkeeper-lockfile-upload
#    when:
#      branch: greenkeeper*
